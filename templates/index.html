<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disease High-Risk Prediction System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .form-label {
            font-weight: bold;  /* 让所有form-label类的label文字加粗 */
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Diabetes assistant diagnostic system</h1>
        <form id="prediction-form" class="mt-4">
    <div class="row">
        <!-- Column 1 -->
        <div class="col-md-6">
            <div class="mb-3">
                <label for="HighBP" class="form-label">High Blood Pressure</label>
                <select class="form-control" id="HighBP" required>
                    <option value="1">Yes</option>
                    <option value="0">No</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="HighChol" class="form-label">High Cholesterol</label>
                <select class="form-control" id="HighChol" required>
                    <option value="1">Yes</option>
                    <option value="0">No</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="BMI" class="form-label">BMI</label>
                <input type="number" step="0.1" class="form-control" id="BMI" placeholder="Enter your BMI" required>
            </div>
            <div class="mb-3">
                <label for="Smoker" class="form-label">Smoker</label>
                <select class="form-control" id="Smoker" required>
                    <option value="1">Yes</option>
                    <option value="0">No</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="Stroke" class="form-label">Stroke</label>
                <select class="form-control" id="Stroke" required>
                    <option value="1">Yes</option>
                    <option value="0">No</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="HeartDiseaseorAttack" class="form-label">Heart Disease or Attack</label>
                <select class="form-control" id="HeartDiseaseorAttack" required>
                    <option value="1">Yes</option>
                    <option value="0">No</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="PhysActivity" class="form-label">Physical Activity</label>
                <select class="form-control" id="PhysActivity" required>
                    <option value="1">Yes</option>
                    <option value="0">No</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="HvyAlcoholConsump" class="form-label">Heavy Alcohol Consumption</label>
                <select class="form-control" id="HvyAlcoholConsump" required>
                    <option value="1">Yes</option>
                    <option value="0">No</option>
                </select>
            </div>
        </div>

        <!-- Column 2 -->
        <div class="col-md-6">


            <div class="mb-3">
                <label for="NoDocbcCost" class="form-label">No Doctor Because of Cost</label>
                <select class="form-control" id="NoDocbcCost" required>
                    <option value="1">Yes</option>
                    <option value="0">No</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="GenHlth" class="form-label">General Health</label>
                <select class="form-control" id="GenHlth" required>
                    <option value="1">Poor</option>
                    <option value="2">Fair</option>
                    <option value="3">Good</option>
                    <option value="4">Very Good</option>
                    <option value="5">Excellent</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="MentHlth" class="form-label">Mental Health</label>
                <input type="number" class="form-control" id="MentHlth" placeholder="Mental health status of the individual (usually 1-30 days of poor mental health in the last 30 days)." required>
            </div>
            <div class="mb-3">
                <label for="PhysHlth" class="form-label">Physical Health</label>
                <input type="number" class="form-control" id="PhysHlth" placeholder="Physical health status of the individual (usually 1-30 days of poor physical health in the last 30 days)." required>
            </div>
            <div class="mb-3">
                <label for="DiffWalk" class="form-label">Difficulty Walking</label>
                <select class="form-control" id="DiffWalk" required>
                    <option value="1">Yes</option>
                    <option value="0">No</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="Age" class="form-label">Age</label>
                <input type="number" class="form-control" id="Age" placeholder="Enter your age" required>
            </div>
            <div class="mb-3">
                <label for="Education" class="form-label">Education Level</label>
                <select class="form-control" id="Education" required>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="Income" class="form-label">Income Level</label>
                <select class="form-control" id="Income" required>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                </select>
            </div>
        </div>
    </div>

    <button type="submit" class="btn btn-primary">Predict</button>
</form>


        <!-- Modal -->
        <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="resultModalLabel">Prediction Result</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="result">
                <!-- The result will be injected here dynamically -->
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById("prediction-form").addEventListener("submit", async (e) => {
            e.preventDefault();
            
            // 收集用户输入数据
        const data = {
            HighBP: document.getElementById("HighBP").value,
            HighChol: document.getElementById("HighChol").value,
            BMI: document.getElementById("BMI").value,
            Smoker: document.getElementById("Smoker").value,
            Stroke: document.getElementById("Stroke").value,
            HeartDiseaseorAttack: document.getElementById("HeartDiseaseorAttack").value,
            PhysActivity: document.getElementById("PhysActivity").value,
            HvyAlcoholConsump: document.getElementById("HvyAlcoholConsump").value,
            NoDocbcCost: document.getElementById("NoDocbcCost").value,
            GenHlth: document.getElementById("GenHlth").value,
            MentHlth: document.getElementById("MentHlth").value,
            PhysHlth: document.getElementById("PhysHlth").value,
            DiffWalk: document.getElementById("DiffWalk").value,
            Age: document.getElementById("Age").value,
            Education: document.getElementById("Education").value,
            Income: document.getElementById("Income").value
        };


            // 发送数据到后端预测
            const response = await fetch("/predict", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            var prediction = `${result.prediction}`;
            var decisionFunction = parseFloat(result.decision_function);

            let category = "Unknown";
            let color = "gray";

            if (prediction === '0') {
                category = "Non_Diabetes";
                color = "green";
            } else if (prediction === '1') {
                category = "Diabetes";
                color = "red";
            }else {
                category = "未知类别";  // 如果prediction不是0,1,2的值，可以返回“未知类别”
                color = "gray";
            }

            // show result
            document.getElementById("result").innerHTML = `
                <h3 style="color: ${color};">Population category: ${category}</h3>
                <p>Probability: ${result.probability}%</p>
            `;

            // 显示模态框
            var myModal = new bootstrap.Modal(document.getElementById('resultModal'), {
                keyboard: false
            });
            
            myModal.show();
        });
    </script>
</body>
</html>
